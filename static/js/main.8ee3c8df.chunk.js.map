{"version":3,"sources":["index.js"],"names":["cookies","Cookies","ControlMode","name","Object","_home_runner_work_infinite_canvas_infinite_canvas_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__","this","Mouse","Trackpad","Shape","id","x","y","dragging","KeyState","Up","Down","Hold","KeyStateHistory","previous","current","Initial","Key","downEventListenerType","upEventListenerType","buttonCode","keyState","key","_useState","useState","_useState2","_home_runner_work_infinite_canvas_infinite_canvas_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","stateHistory","setStateHistory","holdIntervalRef","React","useRef","useEffect","handler","event","button","state","enqueue","setInterval","document","addEventListener","removeEventListener","clearInterval","MouseLeft","MouseRight","App","_useState3","_useState4","shapes","setShapes","_useState5","_useState6","viewportCoordinates","setViewportCoordinates","mouseLeftStateHistory","mouseRightStateHistory","_useState7","_useState8","canvasPanEnabled","setCanvasPanEnabled","_useState9","controlModeCookieValue","get","controlMode","keys","find","toLowerCase","console","log","_useState10","setControlMode","deltaX","deltaY","preventDefault","movementX","movementY","handleControlModeChange","set","react__WEBPACK_IMPORTED_MODULE_4___default","a","createElement","Fragment","style","position","border","zIndex","backgroundColor","type","value","checked","onChange","shape","target","Error","shapeEdgeLength","window","innerWidth","innerHeight","map","react_konva__WEBPACK_IMPORTED_MODULE_6__","width","height","draggable","onDragStart","el","_home_runner_work_infinite_canvas_infinite_canvas_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","onDragEnd","fill","text","render","getElementById"],"mappings":"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","file":"static/js/main.8ee3c8df.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { render } from \"react-dom\";\nimport { Group, Layer, Rect, Stage, Text } from \"react-konva\";\nimport Cookies from \"universal-cookie\";\n\nconst cookies = new Cookies();\n\nclass ControlMode {\n  static Mouse = new ControlMode(\"mouse\");\n  static Trackpad = new ControlMode(\"trackpad\");\n\n  constructor(name) {\n    this.name = name;\n  }\n}\n\nclass Shape {\n  constructor(id, x, y, dragging) {\n    this.id = id;\n    this.x = x;\n    this.y = y;\n    this.dragging = dragging;\n  }\n}\n\nclass KeyState {\n  static Up = new KeyState(\"up\");\n  static Down = new KeyState(\"down\");\n  static Hold = new KeyState(\"hold\");\n\n  constructor(name) {\n    this.name = name;\n  }\n}\n\nclass KeyStateHistory {\n  static Initial = new KeyStateHistory(null, KeyState.Up);\n\n  constructor(previous, current) {\n    this.previous = previous;\n    this.current = current;\n  }\n\n  enqueue(current) {\n    return new KeyStateHistory(this.current, current);\n  }\n}\n\nclass Key {\n  static MouseLeft = new Key(\"mousedown\", \"mouseup\", 0);\n  static MouseRight = new Key(\"mousedown\", \"mouseup\", 2);\n\n  constructor(downEventListenerType, upEventListenerType, buttonCode) {\n    this.downEventListenerType = downEventListenerType;\n    this.upEventListenerType = upEventListenerType;\n    this.buttonCode = buttonCode;\n  }\n}\n\nfunction keyState(key) {\n  const [stateHistory, setStateHistory] = useState(KeyStateHistory.Initial);\n  const holdIntervalRef = React.useRef(null);\n\n  const startHoldIntervalCounter = () => {\n    if (holdIntervalRef.current) return;\n    holdIntervalRef.current = setInterval(() => {\n      setStateHistory((state) => state.enqueue(KeyState.Hold));\n    }, 100);\n  };\n\n  const stopHoldIntervalCounter = () => {\n    if (holdIntervalRef.current) {\n      clearInterval(holdIntervalRef.current);\n      holdIntervalRef.current = null;\n    }\n  };\n\n  useEffect(() => {\n    const handler = (event) => {\n      if (event.button === key.buttonCode) {\n        setStateHistory((state) => state.enqueue(KeyState.Down));\n        startHoldIntervalCounter();\n      }\n    };\n    //TODO customize event listener target\n    document.addEventListener(key.downEventListenerType, handler);\n    return () =>\n      document.removeEventListener(key.downEventListenerType, handler);\n  }, []);\n\n  useEffect(() => {\n    const handler = (event) => {\n      if (event.button === key.buttonCode) {\n        stopHoldIntervalCounter();\n        setStateHistory((state) => state.enqueue(KeyState.Up));\n      }\n    };\n    //TODO customize event listener target\n    document.addEventListener(key.upEventListenerType, handler);\n    return () => document.removeEventListener(key.upEventListenerType, handler);\n  }, []);\n\n  return stateHistory;\n}\n\nconst App = () => {\n  const shapeEdgeLength = 100;\n\n  const [shapes, setShapes] = useState([\n    new Shape(\"id-1\", 312, 326, false),\n    new Shape(\"id-2\", 253, 123, false),\n    new Shape(\"id-3\", 121, 267, false)\n  ]);\n\n  const [viewportCoordinates, setViewportCoordinates] = useState({\n    x: 0,\n    y: 0\n  });\n\n  const mouseLeftStateHistory = keyState(Key.MouseLeft);\n  const mouseRightStateHistory = keyState(Key.MouseRight);\n\n  const [canvasPanEnabled, setCanvasPanEnabled] = useState(false);\n\n  //TODO add automatic detection capability\n  const [controlMode, setControlMode] = useState(() => {\n    const controlModeCookieValue = cookies.get(\"controlMode\");\n    if (controlModeCookieValue) {\n      const controlMode =\n        ControlMode[\n          Object.keys(ControlMode).find(\n            (controlMode) =>\n              controlMode.toLowerCase() === controlModeCookieValue\n          )\n        ];\n      console.log(controlMode);\n      return controlMode;\n    } else {\n      return ControlMode.Mouse;\n    }\n  });\n\n  useEffect(() => {\n    if (controlMode === ControlMode.Trackpad) {\n      const handler = (event) => {\n        setViewportCoordinates((state) => ({\n          x: state.x + -event.deltaX,\n          y: state.y + -event.deltaY\n        }));\n      };\n      document.addEventListener(\"wheel\", handler);\n      return () => document.removeEventListener(\"wheel\", handler);\n    }\n  }, [controlMode]);\n\n  useEffect(() => {\n    const handler = (event) => {\n      event.preventDefault();\n    };\n    document.addEventListener(\"contextmenu\", handler);\n    return () => document.removeEventListener(\"contextmenu\", handler);\n  }, []);\n\n  useEffect(() => {\n    setCanvasPanEnabled(mouseRightStateHistory.current === KeyState.Hold);\n  }, [mouseRightStateHistory]);\n\n  useEffect(() => {\n    if (canvasPanEnabled) {\n      const handler = (event) => {\n        setViewportCoordinates((state) => ({\n          x: state.x + event.movementX,\n          y: state.y + event.movementY\n        }));\n      };\n      document.addEventListener(\"mousemove\", handler);\n      return () => document.removeEventListener(\"mousemove\", handler);\n    }\n  }, [canvasPanEnabled]);\n\n  const handleFocusShape = (event) => {\n    const shape = shapes.find((shape) => shape.id === event.target.value);\n    if (!shape) {\n      throw new Error(\"Failed to find shape by id.\");\n    } else {\n      setViewportCoordinates({\n        x: -shape.x - shapeEdgeLength / 2 + window.innerWidth / 2,\n        y: -shape.y - shapeEdgeLength / 2 + window.innerHeight / 2\n      });\n    }\n  };\n\n  const handleControlModeChange = (controlMode) => {\n    setControlMode(controlMode);\n    cookies.set(\"controlMode\", controlMode.name);\n  };\n\n  return (\n    <>\n      <div\n        style={{\n          position: \"fixed\",\n          border: \"1px solid black\",\n          zIndex: 1,\n          backgroundColor: \"white\"\n        }}\n      >\n        Viewport x:{viewportCoordinates.x} y:{viewportCoordinates.y}\n        <br />\n        Mouse left:{mouseLeftStateHistory.current.name} right:\n        {mouseRightStateHistory.current.name}\n        <br />\n        Canvas pan enabled:{canvasPanEnabled ? \"true\" : \"false\"}\n        <br />\n        Control mode:\n        <div>\n          <input\n            type=\"radio\"\n            value={ControlMode.Mouse.name}\n            name=\"control-mode\"\n            checked={controlMode === ControlMode.Mouse}\n            onChange={() => handleControlModeChange(ControlMode.Mouse)}\n          />{\" \"}\n          {ControlMode.Mouse.name}\n          <input\n            type=\"radio\"\n            value={ControlMode.Trackpad.name}\n            name=\"control-mode\"\n            checked={controlMode === ControlMode.Trackpad}\n            onChange={() => handleControlModeChange(ControlMode.Trackpad)}\n          />{\" \"}\n          {ControlMode.Trackpad.name}\n        </div>\n        Focus shape:\n        <select value=\"\" onChange={handleFocusShape}>\n          <option value=\"\" />\n          {shapes.map((shape) => {\n            return (\n              <option key={shape.id} value={shape.id}>\n                {shape.id}\n              </option>\n            );\n          })}\n        </select>\n      </div>\n      <Stage width={window.innerWidth - 10} height={window.innerHeight - 10}>\n        <Layer>\n          {shapes.map((shape) => (\n            <Group\n              key={shape.id}\n              x={shape.x + viewportCoordinates.x}\n              y={shape.y + viewportCoordinates.y}\n              draggable\n              onDragStart={() => {\n                setShapes((shapes) =>\n                  shapes.map((el) =>\n                    el.id === shape.id ? { ...el, dragging: true } : el\n                  )\n                );\n              }}\n              onDragEnd={(event) => {\n                setShapes((shapes) =>\n                  shapes.map((el) =>\n                    el.id === shape.id\n                      ? {\n                          ...el,\n                          dragging: false,\n                          x: event.target.x() - viewportCoordinates.x,\n                          y: event.target.y() - viewportCoordinates.y\n                        }\n                      : el\n                  )\n                );\n              }}\n            >\n              <Rect\n                width={shapeEdgeLength}\n                height={shapeEdgeLength}\n                fill={shape.dragging ? \"black\" : \"green\"}\n              />\n              <Text\n                x={8}\n                y={40}\n                text={shape.id}\n                fill={shape.dragging ? \"green\" : \"black\"}\n              />\n            </Group>\n          ))}\n        </Layer>\n      </Stage>\n    </>\n  );\n};\n\nrender(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}